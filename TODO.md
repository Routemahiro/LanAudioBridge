- [x] READMEにVB-CABLEのDL先を追記 (2026-02-05 完了)
- [x] .gitignoreの確認（ログ/設定の扱い） (2026-02-05 完了)
- [x] READMEの技術表記修正（WPF→WinForms） (2026-02-05 完了)

- [x] UIリファクタ Phase1: `Form1` をpartial分割（挙動変更なし） (2026-02-05 完了)
  - [x] `Form1.Ui.cs` へUI構築/表示更新を移動
  - [x] `Form1.Settings.cs` へ設定永続化/設定ウィンドウ周りを移動
  - [x] `Form1.Receiver.cs` へ受信系ロジックを移動
  - [x] `Form1.Sender.cs` へ送信系ロジックを移動
  - [x] `Form1.Audio.cs` へ音声処理ヘルパを移動（関数移動のみ）
  - [x] `dotnet build` でビルド確認
  - [x] Phase1完了の声かけ（動作確認依頼）
  - [x] ユーザー動作確認（起動/受信/送信/設定）

- [x] UIリファクタ Phase2: UIとロジック分離（Engine化） (2026-02-05 完了)
  - [x] Engine境界/API設計（イベント通知、UIスレッド境界） (2026-02-05 完了)
  - [x] `ReceiverEngine` 作成（受信/ジッタ/再生） (2026-02-05 完了)
  - [x] `SenderEngine` 作成（キャプチャ/エンコード/送信） (2026-02-05 完了)
  - [x] `Form1` をEngine利用に置換（UIは表示と操作だけ） (2026-02-05 完了)
  - [x] `dotnet build` + スモーク確認 (2026-02-05 完了)

- [x] 音量/ノイズ改善: 送信ゲイン二重適用の解消 + Opus無音時も常時送信（PLCノイズ抑制） (2026-02-05 完了)
  - [x] `SenderEngine` の送信ゲインを1回適用に統一 (2026-02-05 完了)
  - [x] Opusモードは無音でも毎フレーム送信（KeepAlive依存を減らす） (2026-02-05 完了)
  - [x] `dotnet build` で確認 (2026-02-05 完了)

- [x] 音量/運用改善: UI 100% = unity(1.0) + AGC調整 + 受信処理OFF推奨 (2026-02-05 完了)
  - [x] `SendGainBasePercent`/`OutputGainBasePercent` を unity 基準に（100% -> 1.0） (2026-02-05 完了)
  - [x] 送信AGCの `maxBoost`/`noBoostBelow` を見直し（maxBoost 18〜24dB） (2026-02-05 完了)
  - [x] 受信側の音声処理はデフォルトOFF、UIに「OFF推奨」表示 (2026-02-05 完了)
  - [x] `dotnet build` で確認 (2026-02-05 完了)

- [x] 配布/共有: `dotnet publish` 出力をリポジトリ内に固定 (2026-02-05 完了)
  - [x] `publish.ps1` を追加（出力先: `.\publish\...`）
  - [x] READMEに「LAN共有で配布/実行」手順を追記
  - [x] `dotnet publish` 実行確認

---

## UI改善（積極案）

### Phase1: メイン画面のステータス中心化 (2026-02-06 完了)
目的: 「セットアップ画面」→「動作状況ダッシュボード」への転換。普段見るメイン画面に、本当に必要な情報だけを表示する。

- [x] メイン画面レイアウトの再構成 (2026-02-06 完了)
  - [x] ヘッダー: モード切替（受信/送信）＋ 接続状態インジケーター
  - [x] センター: リアルタイム監視エリア（モード別に切替）
  - [x] フッター: ステータスバー（既存を改善）

- [x] 受信モードのメイン画面 (2026-02-06 完了)
  - [x] 接続状態を大きく表示（「接続待ち」「受信中」「エラー」等）
  - [x] 受信音量メーター（Peak/RMS）をメイン画面に昇格
  - [x] 出力後レベルをメイン画面に昇格
  - [x] パケット統計（Packets/Loss/Jitter/Delay）をメイン画面に昇格
  - [x] IP/ポート/CABLE状態は控えめに（折りたたみ or 小さく表示）

- [x] 送信モードのメイン画面 (2026-02-06 完了)
  - [x] 接続先IP入力 + 接続状態を大きく表示
  - [x] 開始/停止ボタンをわかりやすく配置
  - [x] 送信入力レベル（Peak/RMS）をメイン画面に昇格
  - [x] 送信ステータスを視覚的に表示

- [x] 設定ウィンドウの整理 (2026-02-06 完了)
  - [x] 「情報」タブからメーター/統計を削除（メインに移動したため）
  - [x] 「情報」タブはトラブルシューティングガイドに特化
  - [x] 受信/送信の詳細設定はそのまま設定ウィンドウに残す

- [x] `dotnet build` で確認 (2026-02-06 完了)
- [x] ユーザー動作確認 (2026-02-06 完了)

### Phase2: 見た目のモダン化 (2026-02-06 完了)
目的: UIの定数管理・余白統一・モードボタンのアクセント化。ダークテーマは見送り。

- [x] `UiTheme` 静的クラス導入 (2026-02-06 完了)
  - [x] 状態色定数（StateOk/StateWarning/StateError/StateIdle）
  - [x] 警告テキスト色（WarningText/AlertText）
  - [x] アクセント色（Accent/AccentHover/AccentPressed）
  - [x] フォント定義（Segoe UI 4段階: Heading/Body/Caption/Indicator）
  - [x] 余白定数（SpaceXs=4/SpaceSm=8/SpaceMd=16/SpaceLg=24/SpaceXl=32）

- [x] モード切替ボタンのスタイル改善 (2026-02-06 完了)
  - [x] FlatStyle.Flat + 選択中=アクセントブルー / 非選択=システムカラー

- [x] 余白・レイアウトの最適化 (2026-02-06 完了)
  - [x] Padding/Margin を8px基準グリッドに統一
  - [x] 行高さを8px倍数に調整（26→32等）

- [x] ハードコード色をUiTheme定数に置換 (2026-02-06 完了)
- [x] ~~ダークテーマ~~ → 見送り（しっくり来ないため取り消し）
- [x] `dotnet build` で確認 (2026-02-06 完了)
- [x] ユーザー動作確認 (2026-02-07 完了)

### 同時起動防止（Mutex + 既存ウィンドウ前面化） (2026-02-07 完了)
- [x] `Program.cs` に名前付き Mutex を追加（二重起動検知） (2026-02-07 完了)
- [x] 既存プロセスのウィンドウを前面に出す（Win32 API P/Invoke） (2026-02-07 完了)
- [x] 最小化中でも復帰して前面に出す (2026-02-07 完了)
- [x] `dotnet build` で確認 (2026-02-07 完了)
- [ ] ユーザー動作確認

### Phase3: タスクトレイ常駐 + 自動起動・自動接続
目的: 「セットアップしたら放置」を実現。起動→自動接続→トレイ格納の一連の流れ。

- [ ] NotifyIcon でタスクトレイ常駐
  - [ ] トレイアイコンの追加（アプリアイコン）
  - [ ] 右クリックコンテキストメニュー
    - 「ウィンドウを表示」
    - 「設定」
    - セパレータ
    - 「終了」
  - [ ] 最小化時にトレイに格納（タスクバーから消える）
  - [ ] トレイアイコンダブルクリックで復帰
  - [ ] トレイアイコンのツールチップに接続状態を表示

- [ ] 設定に「自動起動・トレイ常駐」オプション追加
  - [ ] `AppSettings` に `AutoStartMinimized` (bool) プロパティ追加
  - [ ] `AppSettings` に `RunAtWindowsStartup` (bool) プロパティ追加
  - [ ] `AppSettings` に `AutoConnect` (bool) プロパティ追加
  - [ ] 設定ウィンドウに「動作設定」セクション追加
    - チェックボックス「起動時に自動接続する」
    - チェックボックス「起動時にタスクトレイに格納する」
    - チェックボックス「Windows起動時に自動起動する」

- [ ] Windows起動時の自動起動
  - [ ] スタートアップフォルダへのショートカット作成/削除
  - [ ] 設定ON/OFFに連動して登録/解除

- [ ] 自動接続機能
  - [ ] 前回の接続モード/設定を記憶（既存の `AppSettings` を活用）
  - [ ] 起動時に `AutoConnect=true` なら自動で前回モードで接続開始
  - [ ] 自動起動時 + `AutoStartMinimized=true` ならウィンドウ非表示→トレイ直行

- [ ] `dotnet build` で確認
- [ ] ユーザー動作確認

### Phase4: エラー復旧導線の強化
目的: トレイ常駐中でもエラーに気づけるように。「何が起きた→どうすればいい」をセットで伝える。

- [ ] エラー状態のUI表示改善
  - [ ] エラー発生時にメイン画面の接続状態インジケーターを赤く変化
  - [ ] 「何が起きたか」+「どうすればいいか」をセットで表示
  - [ ] エラーメッセージのパターン整理（接続切断/デバイス消失/ポート競合等）

- [ ] トレイ通知（バルーン/トースト）
  - [ ] 接続切断時にバルーン通知
  - [ ] エラー発生時にバルーン通知
  - [ ] 再接続成功時にバルーン通知

- [ ] 自動再接続の可視化
  - [ ] 再接続中のリトライ回数/状態をステータスバーに表示
  - [ ] 再接続成功/失敗のログ表示
  - [ ] 一定回数失敗したら「手動確認が必要」通知

- [ ] `dotnet build` で確認
- [ ] ユーザー動作確認
